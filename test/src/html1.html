var isReadonly = "N" == "Y";
/*var lang, baseItem =;*/
/*var verification =, isCheck = false, isPublish = false;*/    /*首先隐藏发布与发布&新建按钮*/
init_page();
function init_page() {
$("#itemTable").html(initItemHade_init());
initItemTableBody([]);        /*设置宽度用于滚动条设置*/
$("#itemTable").width(iMain.getW(parent, true));    }    /* 初始化表头 */
function initItemHade_init() {
costName = "";
var table = "<table class='common-table item'>";
    table += "<thead class='head-table'><tr>";
        table += "<th class='left-column'  style='width:20px'> 参评人员</th>";
        table += "<th class='left-column'  style='width:80px'> 评审意见</th>";
        table += "<th class='left-column'  style='width:60px'> 回复</th>";
        table += "<th class='left-column'  style='width:20px;display:none' > 参评人员id</th>";
        table += "</tr></thead>";
    table += "<tbody id ='ItemTableBody' SN='0'></tbody>";
    table += "</table>";        return table;    }    /* 初始化表内容 */
function initItemTableBody(data) {
var h = [];
data = data ? data : [];
var baseInfo, clz, val, d;
for (var i = 0; i < data.length; i++) {
d = data[i];
h.push("<tr class=" , i % 2 ? 'odd' : 'even', " id=", d.ID, " ");            h.push(">");            /*"ID,templateId,,,roleName,,,WishSolveTime,executeRemark,executeStatus,checkingRemark,checkingStatus,objectId,isValid,SN,ModifyID,ModifyTime"*/            /* type、class、val、showName、是否只读0只读：1可修改 */            var tds =                + ",TEXT#reviewPersonName#reviewPersonName#0"/*参评人员*/                + ",TEXT#comment#comment#0"/*评审意见*/                + ",TEXT#reply#reply#0" /*回复*/                + ",HIDDENTEXT#reviewPersonId#reviewPersonId#1" /*备份数据1*/            ;            h.push("<td name='SN' >", seq++, "</td>");            var tdArr = tds.split(","), baseinfo;            for (var td = 0; td < tdArr.length; td++) {                var tdAttr = tdArr[td].split("#");                h.push("<td name='", tdAttr[1], "' val='", d[tdAttr[1]] , "'>", initInputType(tdAttr[0], tdAttr[1], d[tdAttr[1]], baseinfo, "0" == tdAttr[3], d[tdAttr[2]],d), "</td>");            }            h.push("</tr>");        }        $("#ItemTableBody").append(h.join(""));    }    function addItemTabel() {        var data = [{}];        initItemTableBody(data);    }    /*根据字段类型设置不同的控件*/    function initInputType(inputType, className, inputVal, dataInfo, isRead, inputValName,d) {        inputVal = inputVal ? inputVal : "";        inputValName = inputValName ? inputValName : "";        if (!isRead) {            isRead = isReadonly;        }        var text = "";        if (inputType == "SN") {  /*序号*/            var sn = $("#ItemHadeBody").attr("SN");            text = "<input type='text' class='text  " + className + "'  onkeyup='validateNumber($(this));' onBlur='validateNumber($(this));'  value='" + sn + "'>";            return text;        } else if (inputType == "TEXT") {  /*当行文本，多行文本*/            if (isReadonly) {                return initisReadonly(className, inputVal, inputValName);            }            var val =inputVal;            text = "<input width='80%' type='text' class='text  " + className + "' value='" + val + "'>";            return text;        } else if (inputType == "SELECT" || inputType == "RADIO") { /*下拉菜单和单选，同意设置为单选 */            return _getSelectHTML(dataInfo, true, inputVal, isRead, className);        } else if (inputType == "DATE") { /*时间选择*/            if (isRead) {                return initisReadonly(className, inputVal, inputValName);            }            text = '<input type="text" onclick="iCalendar.setDay($(this));"  class="text ' + className + ' "  readonly="readonly"  value="' + inputVal + '" />' +                '<img src="/images/icon041.gif" onclick="$(this).prev().click();"/>';        } else if (inputType == "USER" || inputType == "DEPARTMENT" || inputType == "PROJECT") { /*用户、部门、项目弹出选择框*/            if (isRead) {                return initisReadonly(className, inputVal, inputValName);            }            text = '<input class="text ' + inputType + ' ' + className + ' " ids="' + inputVal + '" type="text" onClick="openwindow($(this))" value="' + inputValName + '">';        } else if (inputType == "NUMBER") { /*数字*/            if (isRead) {                return initisReadonly(className, inputVal, inputValName);            }            text = "<input type='text' class='text " + className + "'  onkeyup='validateNumber($(this));' onBlur='validateNumber($(this));'  value='" + inputValName + "'>";        } else if (inputType == "CHECKBOX") {/*复选框,下拉多选*/            if (isRead) {                return initisReadonly(className, inputVal, inputValName);            }            text = '<input class="text ' + className + ' ids="' + inputVal + '" ids="' + inputVal + '" readonly="readonly" ids="" onclick="showSelect($(this), true, "name=TypeID&module=PJT");"/>';        } else if (inputType == "AREA") {            if (isRead) {                return initisReadonly(className, inputVal, inputValName);            }            var h = getAreaHeight(inputValName);            text = '<textarea class="input_textarea field-edit field-edit-long" style="height:' + h + 'px;width: 155px;" value="' + inputValName + '">' + inputValName + '</textarea>';        } else if (inputType == "SPAN") {            text = '<span class="' + className + '">' + inputValName + '</span>';        } else if (inputType == "A") {            text = '<a style="color: blue;" onClick="opendEntity(\'' + inputVal + '\',\'MRQ\');" >' + inputValName + '</span>';        } else if( inputType =="HIDDENTEXT"){            if (isReadonly) {                return initisReadonly(className, inputVal, inputValName);            }            var val =inputVal;            text = "<input width='80%' type='hidden'  class='text  " + className + "' value='" + val + "'>";            return text;        }        return text;    }    /*自动设置多行文本框高度*/    function getAreaHeight(val) {        var h = val && val.length > 64 ? (20 * val.length / 32) : 40;        return h;    }    /*只读属性*/    function initisReadonly(className, inputVal, inputValName) {        return '<span class="' + className + '" val="' + inputVal + '">' + inputValName + '</span>';    }    /* 初始化下拉框 */    function _initSelect($row, $s, val, type, onchangeFun) {        var scrollName = $.browser.msie ? "a" : "outDiv";        $s.select({            scroll: scrollName,            isFilter: true,            onbeforeshow: function ($ss) {                if ($ss.find("li").size() > 10) $ss.find("ul").height(200);            },            onshow: function ($ss, $u) {                if ($.browser.msie) {                    var rowTop = $row.attr("rowIndex") * $row.attr("offsetHeight") + 55;                    var h = ($u.find("li").size() - 1) * 24;                    h = h > 200 ? 200 : h;                    var top = $row.offset().top + h > iMain.getTH(parent, true) ? (rowTop - h - 10) : (rowTop + 15);                    $u.css({"top": top, "left": $ss.closest("td").offset().left + 15});                    window.setTimeout(function () {                        $ss.config.showed = false;                    });                }            },            onchange: function (i) {                $s.closest("td").attr("val", i);                if (typeof onchangeFun == "function") {                    onchangeFun($s, i, $row);                }            }        }).selectVal(val);    }    /*遍历select*/    function _getSelectHTML(object, showEmp, readVal, readOnly, className) {        var s = [], info, flag = false;        /*只读时 */        if (readOnly) {            for (var i in object) {                info = object[i];                if (readVal == info.i) {                    s.push("<div class='" + className + "' val= '", info.i, "'>", info.v, "</div>");                    flag = true;                    break;                }                if (flag) break;            }            if (!flag) s.push("<div class='planName-div' val= '", readVal, "'>", readVal, "</div>");        } else {            s.push("<div class='select-div " + className + "'><ul style='display: none;'>");            if (showEmp) s.push("<li class='menu-li-empty' val>请选择</li>");            for (var i in object) {                var info = object[i];                s.push("<li val= '", info.i, "' ", (!info.i ? "valid='N'" : ""), ">", info.v, "</li>");            }            s.push("</ul></div>");        }        return s.join("");    }    /* 数字校验 */    function validateNumber(data) {        var req = /^([0-9]+)(\.)?[0-9]{0,2}$/;        var d = data.val();        data.attr("isChange", "Y");        /*判断为数字 */        if (!req.test(d)) {            data.val(d.substr(0, d.length - 1));        }    }    /* 打开项目弹出框 */    function openwindow($obj) {        var clz = $obj.attr("class"), url = powerPath;        /* 单选项目弹出框 */        if (clz.indexOf("PROJECT") >= 0) {            url += "pages/common/searchProjectWin.jsf";        } else if (clz.indexOf("USER") >= 0) {            url += "pages/common/searchUserMul.jsf";        } /*用户多选弹出框*/            /*else if(clz.indexOf("USER")>=0){ url += "/pages/common/searchUserWin.jsf";} 用户单选弹出框*/        /*else {  url += "pages/common/searchDepartmentMul.jsf";}部门弹出框多选*/        else {            url += "pages/common/searchDepartmentWin.jsf";        }/*部门弹出框单选*/        showModDialog(url, 600, 500, [$obj.attr("ids"), $obj.val()], function (msg) {            var ids = "", names = "";            if (msg != null && msg != "") {                ids = msg.split("%&*%")[0];                names = msg.split("%&*%")[1];            }            $obj.attr("ids", ids).val(names);        });    }    function Fld_00001_save() {        var info = "", tdJson = [], trArr = [], typeJson = [], tripArr = [];        var $trs = $("#ItemTableBody tr");  /*表格循环*/        trArr = [];        trArr.push("[");        for (var i = 0; i < $trs.length; i++) {   /*行循环 */            var $tr = $trs.eq(i);            var id = $tr.attr("id");            tdJson = [];            if (trArr.length > 1) {                trArr.push(",");            }            tdJson.push("{");            tdJson.push('"ID":"', id, '"');            var $tds = $tr.find("td");            for (var j = 0; j < $tds.length; j++) {                var $td = $tds.eq(j);                var name = $td.attr("name");                var val = $td.attr("val");                if (name) {                    var $input = $td.find("input");                    var $selectText = $td.find(".select-text");                    var $textarea = $td.find("textarea");                    if ($input.length > 0 && $selectText.length == 0) { /*文本框*/                        val = $input.val();                        var ids = $input.attr("ids"); /*是否为ID*/                        val = ids ? ids : val; /*无相关数据ID时获取对应显示值*/                    } else if ($textarea.length > 0) {                        val = $textarea.val();                    }                    tdJson.push(',"', name, '":"', val, '"');                }            }            tdJson.push("}");            trArr.push(tdJson.join(""));        }        trArr.push("]");        $("#partData").val(trArr.join(''));        return true;    }


    var h = [];
    data = data ? data : [];
    var baseInfo, clz, val, d;
    for (var i = 0; i < data.length; i++) {
    d = data[i];
    h.push("<tr class=", i % 2 ? 'odd' : 'even', " id='", d.ID, "' ");
    h.push(">");
    /*"ID,templateId,,,roleName,,,WishSolveTime,executeRemark,executeStatus,checkingRemark,checkingStatus,objectId,isValid,SN,ModifyID,ModifyTime"*/
    /* type、class、val、showName、是否只读0只读：1可修改 */
    var tds =
    + ",TEXT#reviewPersonName#reviewPersonName#0"/*参评人员*/
    + ",TEXT#comment#comment#0"/*评审意见*/
    + ",TEXT#reply#reply#0" /*回复*/
    + ",HIDDENTEXT#reviewPersonId#reviewPersonId#1" /*参评人员id*/
    ;
    h.push("<td name='SN' >", seq++, "</td>");
    var tdArr = tds.split(","), baseinfo;
    for (var td = 0; td < tdArr.length; td++) {
    var tdAttr = tdArr[td].split("#");
    h.push("<td name='", tdAttr[1], "' val='", d[tdAttr[1]] , "'>", initInputType(tdAttr[0], tdAttr[1], d[tdAttr[1]], baseinfo, "0" == tdAttr[3], d[tdAttr[2]],d), "</td>");
    }